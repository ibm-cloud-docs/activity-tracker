---

copyright:
  years: 2022
lastupdated: "2022-05-16"

keywords: IBM Cloud, Activity Tracker, security, auditing, target, logdna

subcollection: activity-tracker

---

{{site.data.keyword.attribute-definition-list}}


# About configuring {{site.data.keyword.atracker_short}} Event Routing
{: #atracker-resources}

Use {{site.data.keyword.atracker_short}} to collect auditing events that are generated by services in your {{site.data.keyword.cloud_notm}} account. The events comply with the Cloud Auditing Data Federation (CADF) standard. 
{: shortdesc}


This information applies only if you use {{site.data.keyword.atracker_full}} Event Routing.
{: important}

![The {{site.data.keyword.atracker_short}} service](images/atracker_ov.svg "The {{site.data.keyword.atracker_short}} service"){: caption="Figure 1. The {{site.data.keyword.atracker_short}} service" caption-side="bottom"}


## Configuring the account
{: #atracker-resources-config}

To configure {{site.data.keyword.atracker_short}} Event Routing in your account, define where auditing events are routed and stored. You must configure 1 or more targets, and 1 or more routes. You must also configure the account settings.
- A target defines the resource where you can store auditing events. 
- A route defines the rules that determine where auditing events are routed in your account.
- The account settings configuration defines information such as default targets where events are collected in the account, type of endpoints that are allowed to manage the configuration, and allowed locations to store the data in the account.

You can collect [global events](/docs/activity-tracker?topic=activity-tracker-event_types#event_types_global) and [location-based events](/docs/activity-tracker?topic=activity-tracker-event_types#event_types_location). 
- Global events report on activity in your account that relate to data and resources that are generally synchronized across all regions. 
- Location-based events report on activity in your account that is generated by IBM Cloud services that are hosted within an IBM data centre location, like US-South or US-East. 

Per account, you can choose the region where events are collected.  

## Account configuration settings
{: #atracker-resources-settings}

When you configure the {{site.data.keyword.atracker_short}} Event Routing account settings, you can define any of the following information:
1. The location in your {{site.data.keyword.cloud_notm}} account where the {{site.data.keyword.atracker_short}} Event Routing account configuration metadata is stored. 

    By metadata, we refer to the target/route/settings data that is available across the account in any region.

    You can choose any of the supported locations where {{site.data.keyword.atracker_short}} Event Routing is available. For more information, see [Locations](/docs/activity-tracker?topic=activity-tracker-regions&interface=cli).

    Take into account any corporate or industry compliance requirements such as Financial Services Validated locations, or EU-managed regions, and any data residency requirements.

2. The type of endpoints that are allowed to manage the {{site.data.keyword.atracker_short}} Event Routing account configuration in the account. 

    You can configiure public endpoints, private endpoints, or both.

3. The locations where an account administrator can define targets to collect auditing events.

    You can choose any of the supported locations where {{site.data.keyword.atracker_short}} Event Routing is available. For more information, see [Locations](/docs/activity-tracker?topic=activity-tracker-regions&interface=cli).
    
    Take into account any corporate or industry compliance requirements such as Financial Services Validated locations, or EU-managed regions, and any data residency requirements.

4. 1 or more targets in the account that will collect auditing events from supported {{site.data.keyword.atracker_short}} Event Routing locations where you have not configured how you want to route the auditing events. 

    If you define more than 1 target, all default targets get a copy of the auditing events that do not have a routing rule to indicate where to route them in the account. You can define up to 2 default targets per account.
    {: note}


When you configure or modify the {{site.data.keyword.atracker_short}} Event Routing account settings, consider the following information:

- Every time you modify the {{site.data.keyword.atracker_short}} Event Routing account settings, the data that is passed in the new request replaces any existing configuration data. You must ensure that any existing data is not deleted when you run an update of the account settings by including it in the new request.
{: important}

- Before you disable public endpoints by setting `--private-api-endpoint-only TRUE`, make sure your account has access to the private endpoint.  You can do this by running the command `ibmcloud account show`.  If `VRF Enabled` is `true` and `Service Endpoint Enabled` is `true` then you have access to the private endpoint.  If you do not have access to the private endpoint, you will be unable to re-enable the public endpoint since private endpoint access is required to re-enable the public endpoint.
{: important}


## Targets
{: #atracker-resources-targets}

A target defines where auditing events are collected.

Note the following information about targets:

* You can define up to 16 targets in each account. 

* Each account can have up to 2 default targets. A default target defines a resource where auditing events that are not explicitly managed in the account's routing rules are sent.

* A target can be either an {{site.data.keyword.cos_full_notm}} (COS) bucket or the {{site.data.keyword.atracker_short}} hosted event search offering.

* All targets can be accessed by any {{site.data.keyword.atracker_short}} API endpoint.

* Targets are created within a region but are visible across regions. 

* You can define targets in the same account where events are generated or in a different account.

* When you define a Cloud Object Storage target, you can use an API key or service to service authentication to upload events.

* You can manage targets in your account by using the {{site.data.keyword.atracker_short}} CLI, and programmatically by using the {{site.data.keyword.atracker_short}} Event Routing REST API and Terraform scripts.

* To manage targets, you need IAM permissions. For more information, see [{{site.data.keyword.atracker_short}} Event Routing actions](/docs/activity-tracker?topic=activity-tracker-iam&interface=cli#platform).


The following table outlines valid target types:

| Target                                      | Type                     |
|---------------------------------------------|--------------------------|
| {{site.data.keyword.cos_full_notm}} (COS) | `cloud_object_storage`   |
| {{site.data.keyword.atracker_short}} hosted event search offering | `logdna`   |
{: caption="Table 1. List of targets" caption-side="top"}

Use the following diagram to decide what type of targets you need:

![Diagram showing the {{site.data.keyword.atracker_full_notm}} target types based on requirements](images/overview-flow.svg "The {{site.data.keyword.atracker_full_notm}} target types based on requirements"){: caption="Figure 2. The {{site.data.keyword.atracker_full_notm}} target types based on requirements" caption-side="bottom"}


For more information, see [Managing COS targets by using the V2 API](/docs/activity-tracker?topic=activity-tracker-target_v2_cos&interface=cli) and [Managing IBM Cloud Activity Tracker hosted event search targets by using the V2 API](/docs/activity-tracker?topic=activity-tracker-target_v2_at&interface=cli).

Check out these tutorials:
- [Configuring a Cloud Object Storage target in the account that generates the auditing events by using a service ID](/docs/activity-tracker?topic=activity-tracker-getting-started-target-1).
- [Configuring a Cloud Object Storage target in a different account from the one that generates the auditing events by using service to service authorization](/docs/activity-tracker?topic=activity-tracker-getting-started-target-2).
- [Configuring a LogDNA target in the account that generates the auditing events](/docs/activity-tracker?topic=activity-tracker-target_v2_at&interface=cli).
- [Configuring a LogDNA target in the account in a different account from the one that generates the auditing events](/docs/activity-tracker?topic=activity-tracker-target_v2_at&interface=cli).




## Routes
{: #atracker-resources-routes}

A route defines the rules that indicate what auditing events are routed in a region and where to store them.

* Routes are global under an account and are evaluated in all regions where {{site.data.keyword.atracker_short}} is deployed.

* Routes may be managed from any regional {{site.data.keyword.atracker_full}} API endpoint.

* You can define up to 4 routes for an account.

* By default, the account has 0 routes configured.

* You can configure up to 4 rules for each route. A routing rule indicates the locations and associated targets where auditing events are routed.

* You can configure up to 8 locations for each rule.

* You can configure up to 3 targets (`target_ids`) for each rule.

* Routes are processed independently.  If you have multiple routes with rules that match the same event, that event will be sent to multiple targets.

* Rules are processed in order.  The first matching rule (for example,  `location`) an event matches will be used to process the event.  Once an event has been processed it will not be processed by a subsequent rule within that route's definition. If you want to specify a default rule for all events that were not processed by other rules you would specify the rule (`"locations" : ["*"]`) as the final rule in your `rules` definition for the `route`.

* If an event doesn't match any rule and no default target is configured, the event will be dropped and not routed to any target.

* Any update to a `rules` configuration must include all `location` rules.  An update will discard the existing rule set and replace it with the specified configuration.

* You can manage routes in your account by using the {{site.data.keyword.atracker_short}} CLI, and programmatically by using the {{site.data.keyword.atracker_short}} Event Routing REST API and Terraform scripts.

* To manage routes, you need IAM permissions. For more information, see [{{site.data.keyword.atracker_short}} Event Routing actions](/docs/activity-tracker?topic=activity-tracker-iam&interface=cli#platform).


## Collecting auditing events
{: #atracker-resources-collect}

To collect auditing events in your {{site.data.keyword.cloud_notm}} account, you can configure {{site.data.keyword.atracker_short}} Event Routing by using the {{site.data.keyword.atracker_short}} Event Routing API, the {{site.data.keyword.atracker_short}} Event Routing CLI and Terraform scripts.

The {{site.data.keyword.atracker_full}} Event Routing feature has been enhanced and a new API version 2 is available. To use the new V2 features and configurations, your existing {{site.data.keyword.atracker_short}} Event Routing V1 account configuration must be migrated to an {{site.data.keyword.atracker_short}} Event Routing V2 account configuration.
{: note}

If you configured {{site.data.keyword.atracker_full}} Event Routing prior to 16 May 2022, you will need to migrate your configuration to the new version V2. The {{site.data.keyword.atracker_full}} Event Routing API version 1 is deprecated. For more information, see [Migrating the {{site.data.keyword.atracker_short}} Event Routing account configuration from V1 to V2](/docs/activity-tracker?topic=activity-tracker-migration&interface=cli).

For more in formation, see [Collecting events](/docs/activity-tracker?topic=activity-tracker-events_collect&interface=cli).


## What are the API V2 enhancements?
{: #atracker-api-diff}

The following table outlines key feature differences between {{site.data.keyword.atracker_short}} Event Routing API versions:

| Feature comparison | API Version 2 | API Version 1 (deprecated) |
|--------------------|---------------|----------------------------|
| Each region is managed separately. | | ![Checkmark icon](images/checkmark-icon.svg) |
| The account configuration is managed in a user-specified location. | ![Checkmark icon](images/checkmark-icon.svg) | |
| You can restrict the location where targets are defined in the account. | ![Checkmark icon](images/checkmark-icon.svg) | |
| You can configure 1 or more default targets for events not explicitly managed in the account's routing rules. | ![Checkmark icon](images/checkmark-icon.svg) | |
| You can define a Cloud Object Storage target by configuring a bucket within the account. | ![Checkmark icon](images/checkmark-icon.svg) | ![Checkmark icon](images/checkmark-icon.svg) |
| You can define a Cloud Object Storage target by configuring a bucket in a different the account. | ![Checkmark icon](images/checkmark-icon.svg) | ![Checkmark icon](images/checkmark-icon.svg) |
| You can define an instance of the {{site.data.keyword.atracker_short}} Event Search offering as a target. | ![Checkmark icon](images/checkmark-icon.svg) | |
| You can use an API Key to write auditing events into a bucket. | ![Checkmark icon](images/checkmark-icon.svg) | ![Checkmark icon](images/checkmark-icon.svg) |
| You can configure service to service authorization to write auditing events to a bucket. The bucket can be in the same account where events are generated or in a different account. | ![Checkmark icon](images/checkmark-icon.svg) | |
| You can define the target where global events are collected in your account. | ![Checkmark icon](images/checkmark-icon.svg) | ![Checkmark icon](images/checkmark-icon.svg) |
| Auditing events are routed based on the location where they are generated. | | ![Checkmark icon](images/checkmark-icon.svg) |
| Auditing events are routed based on the location that is specified in the field `logSourceCRN`. | ![Checkmark icon](images/checkmark-icon.svg) | |
| Routes are specific to a region. | | ![Checkmark icon](images/checkmark-icon.svg) |
| Routes are global to the account. | ![Checkmark icon](images/checkmark-icon.svg) | |
{: caption="Table 1. {{site.data.keyword.atracker_short}} Event Routing API version feature comparison" caption-side="top"}




